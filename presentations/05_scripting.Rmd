---
title: "Data analysis and visualization using R (1)"
author: "Michiel Noback"
date: "December 2019"
output:
  slidy_presentation: default
  ioslides_presentation: default
  beamer_presentation:
    colortheme: dolphin
    fig_caption: no
    toc: yes
subtitle: using and writing functions in R
job: lecturer at Hanze University of Applied Science
---

```{r setup, cache = F, echo = F, message = F, warning = F}
#comment this out for pdf output
source("rmarkdown_knitr_header.R")
knitr::opts_chunk$set(error = TRUE)
```

```{r echo = F}
par(mar=c(4, 4, 1.5, 0))
```

## Contents

- Flow control
- Writing functions
- Creating and running scripts

# Flow control

## What is flow control?

- Flow control constitutes a series of code elements used to control whether some code blocks are executed or not, and how many times
- These structures are used for flow control  
    - `if(){} else if(){} else{}` - Conditional execution
    - `for(){}` - Repeated execution
    - `while(){}` - Repeated conditional execution

## if/else: conditional execution

- Since flow control is used primarily within functions it is dealt with here
- The first is `if & else` for conditional code 

```{r ifelse_demo}
x <- 43
if (x > 40) {
    print("TRUE")
} else {
    print("FALSE")
}
```


## if/else real life example

- This code chunk checks if a file exists and only downloads it if it is not present

```{r eval=FALSE}
my_data_file <- "/some/file/on/disk"
## fetch file
if (!file.exists(my_data_file)) {
    print(paste("downloading", my_data_file))
    download.file(url = remote_url, destfile = my_data_file)
} else {
    print(paste("reading cached copy of", my_data_file))
}
```


## ifelse ternary

There is also a shorthand for `if(){}else{}`

```{r ternary_op}
a <- 3
x <- if (a == 1) 1 else 2
x
```

## if/else on dataframes: `ifelse()`

ifelse on dataframes: this is wrong:
```{r}
#only first value evaluated
airquality$foo <- if (airquality$Ozone < 30) 0 else 1 
```

but this works:
 
```{r}
airquality$bar <- ifelse(airquality$Ozone < 30, 0, 1)
head(airquality)
```


## for: iteration

- `for` is used for looping a series of values
- The preferred way to loop the columns or rows of a dataframe is with `apply()` and its relatives (next presentation)

```{r for-loop1}
for (i in 1:3) {
    print(i)
}
```

----

Sometimes, a `for` loop is handy with indexing

```{r for-loop2}
x <- c("foo", "bar", "baz")
for (i in 1 : length(x)) {
    print(x[i])
}
```


# Creating functions

## Functions are named code blocks

- Functions are named blocks of code with a single well-defined purpose
- They ususally have some data as input: its **arguments**
- They usually have some **return** value
- You have already used many **_predefined_** ones: `str`, `max`, `read.table` etc.
- Defined with  
  ```
    my_function <- function(arg, arg, ...) {
            <function body with return statement>
        }
  ```

## A first function

- Here is a simple function determining whether some number is even

```{r first_function}
is_even <- function(x) {
    evens <- x %% 2 == 0
    return(evens) ##explicit return() not required 
}
is_even(1:5)
```


## Function basics

- The result of the last statement within a function is the return value of that function
- Use `return()` for forcing return values at other points:

```{r return_values}
my_message <- function(age) {
    if (age < 18) return("have a lemonade!")
    "have a beer!" #implicit return statement
}
my_message(20)
```


## Default argument values

- Use default values for function arguments whenever possible
- Specified with `some_arg = <default-value>`
- Almost all functions in R packages have many arguments with default values

```{r default_args}
my_power <- function(x, power = 2) {
    x ^ power
}
my_power(10, 3) ## custom power
my_power(10) ## defaults to 2
```

